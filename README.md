# Tracer Robot Army

> ⚠️ This README was automatically generated by AI, and might not reflect the author's intent. A more accurate README will be here soon.

A systematic approach to generating pattern matching rules for monitoring bioinformatics software execution at scale.

## Overview

The **Tracer Robot Army** is an automated pipeline that analyzes source code of bioinformatics software (currently Nextflow workflows) and generates precise pattern matching rules for detecting specific process executions in system traces. Think of it as an army of small, specialized robots that each learn to recognize and trace different bioinformatics tools and processes.

## Name & Motivation

The name reflects the core challenge this project addresses: **the need to write thousands of similar micro-programs to comprehensively cover the vast bioinformatics software domain**.

- **Tracer**: The system traces and monitors software execution patterns
- **Robot**: Each generated rule is like a small, automated detection program
- **Army**: We need many of these (hundreds to thousands) to cover the entire bioinformatics ecosystem

Rather than manually writing detection rules for every bioinformatics tool, this project automatically extracts execution patterns from source code and generates monitoring rules at scale.

## Architecture

The system follows a multi-stage pipeline:

### Stage 1: Source Code Extraction (`001-source-extract.ts`)

- Scans Nextflow module repositories for process definitions
- Extracts executable script blocks (triple-quoted segments and template files)
- Uses AI to generate realistic execution examples with:
  - Actual shell commands with variables substituted
  - Expected `sched_process_exec` events that would be captured

### Stage 2: Pattern Generation (`002-pattern-generate.ts`)

- Analyzes execution examples to identify the primary command patterns
- Generates regex patterns that can uniquely identify process executions
- Focuses on the main bioinformatics tool being called (not helper commands)

### Stage 3: Description Addition (`003-add-descriptions.ts`)

- Adds human-readable descriptions (2-5 words) for each process
- Provides clear, concise labels like "Sort BAM files" or "Quantify transcript abundance"

### Stage 4: Structured Rule Generation (`004-extract-structured-rules.ts`)

- Converts all extracted information into structured JSON rules
- Each rule contains:
  - Unique identifier (e.g., `nextflow/core/SAMTOOLS_SORT`)
  - Human-readable label
  - Regex pattern for detection
  - Quality metrics and test fixtures

### Stage 5: Quality Evaluation (`quality.ts`)

- Validates generated rules against real workflow logs
- Identifies false positives and false negatives
- Reports coverage and accuracy metrics

## Current Focus: Nextflow Process Monitoring

The initial implementation targets **Nextflow workflow process execution monitoring** by analyzing `sched_process_exec` system call events. This allows detection of:

- Which bioinformatics tools are being executed
- When specific analysis steps occur in workflows
- Resource usage patterns for different process types

## Future Expansion

The architecture is designed to expand beyond process monitoring to include:

- **Log pattern matching**: Detecting specific events in application logs
- **Network traffic patterns**: Identifying data transfer and API usage
- **File system events**: Tracking input/output file operations
- **Error pattern recognition**: Automated detection of common failure modes

## Usage

### Prerequisites

- Node.js and TypeScript
- Anthropic API key for AI-powered pattern generation
- Access to Nextflow module repositories

### Running the Pipeline

```bash
# Extract source code patterns
npm run extract-source

# Generate regex patterns
npm run generate-patterns

# Add descriptions
npm run add-descriptions

# Create structured rules
npm run create-rules

# Evaluate quality
npm run evaluate-quality
```

### Example Output

Generated rules follow this structure:

```json
{
  "id": "nextflow/core/SAMTOOLS_SORT",
  "label": "Sort BAM files",
  "pattern": "^samtools sort.*-o \\S+\\.bam",
  "quality": {
    "ai_self_eval_pattern_score": {
      "value": "95",
      "reasoning": "High confidence pattern with minimal edge cases"
    }
  },
  "test_fixtures": [
    {
      "label": "Standard BAM sorting",
      "script": "samtools sort -@ 4 -o sorted.bam input.bam",
      "commands": ["samtools sort -@ 4 -o sorted.bam input.bam"]
    }
  ]
}
```

## Repository Structure

- `src/001-source-extract.ts` - Nextflow source code analysis and example generation
- `src/002-pattern-generate.ts` - AI-powered regex pattern generation
- `src/003-add-descriptions.ts` - Human-readable description generation
- `src/004-extract-structured-rules.ts` - Structured rule compilation
- `src/quality.ts` - Rule validation and quality metrics
- `src/common.ts` - Shared utilities and rule matching engine
- `inputs/repositories.txt` - List of Nextflow repositories to analyze
- `results/` - Generated rules and intermediate outputs

## Contributing

This project aims to build comprehensive coverage of the bioinformatics software ecosystem. Contributions welcome for:

- Additional source code analyzers (Snakemake, WDL, etc.)
- New signal types beyond process execution
- Quality improvement algorithms
- Coverage expansion to new tool categories
